{"componentChunkName":"component---src-templates-blog-post-js","path":"/서비스워커에-대하여/","result":{"data":{"site":{"siteMetadata":{"title":"read0more's blog"}},"markdownRemark":{"id":"015eae78-9005-5c56-8994-514cf77009a4","excerpt":"서비스 워커? 최근 테스트를 작성하면서 MSW(Mock Service Worker)를 이용하고 있는데, MSW가 서비스 워커를 이용하여 작성된 라이브러리이기 때문에 관심이 생겨서 알아보게 되었다. MDN…","html":"<h2>서비스 워커?</h2>\n<p>최근 테스트를 작성하면서 MSW(Mock Service Worker)를 이용하고 있는데, MSW가 서비스 워커를 이용하여 작성된 라이브러리이기 때문에 관심이 생겨서 알아보게 되었다.</p>\n<p>MDN의 서비스 워커 설명을 빌리자면 이렇다.</p>\n<blockquote>\n<p>서비스 워커는 웹 응용 프로그램, 브라우저, 그리고 (사용 가능한 경우) 네트워크 사이의 프록시 서버 역할을 합니다. 서비스 워커의 개발 의도는 여러가지가 있지만, 그 중에서도 효과적인 오프라인 경험을 생성하고, 네트워크 요청을 가로채서 네트워크 사용 가능 여부에 따라 적절한 행동을 취하고, 서버의 자산을 업데이트할 수 있습니다. 또한 푸시 알림과 백그라운드 동기화 API로의 접근도 제공합니다.</p>\n</blockquote>\n<p>중요한 포인트는 다음과 같다고 생각한다.</p>\n<ol>\n<li>백그라운드에서 실행됨</li>\n<li>프록시 서버 역할을 한다</li>\n</ol>\n<p>백그라운드에서 실행에 대한 부분만 부가 설명을 하자면</p>\n<ul>\n<li>메인 JS와는 다른 스레드에서 동작하므로 서비스 워커의 작업이 메인 스레드의 JS 작업을 방해하지 않는다(논 블로킹). 하지만 DOM과 Web Storage에 접근 할 수는 없다.</li>\n</ul>\n<h2>서비스 워커의 생명주기</h2>\n<p>서비스 워커를 작성할 때 필수적으로 알아야 하는 부분이라고 할 수 있다. 생명주기는 다음과 같다.</p>\n<h4>1. 서비스 워커가 제어하는 사이트에 처음 접근하는 순간 다운로드</h4>\n<h4>2. 서비스 워커 설치</h4>\n<h4>3. 서비스 워커 활성화</h4>\n<p>기억해 둘 것은 처음 들어와서 활성화가 됐다고 하더라도 이미 브라우저가 응답을 받은 상태이기 때문에 서비스 워커에 작성한 동작은 다시 방문해야 확인이 가능할 것이다.</p>\n<h2>서비스 워커의 업데이트 특징</h2>\n<h3>1. 기존 서비스 워커 파일과의 <strong>바이트 단위 비교</strong>로 구분하여 업데이트 한다.</h3>\n<p>이게 뭐가 좋냐하면...그동안 실무를 하면서 js,css파일에 대한 수정사항을 즉각 반영하려 이전 캐싱을 무효화 하기 위해 다음과 같이 사용하는 경우를 자주 볼 수 있었다.</p>\n<p><code>&#x3C;script src=\"/js/some.js?ver=1.0.0\">&#x3C;/script></code></p>\n<p>더 최악은 아예 querystring에 timestamp를 넣어서 아예 캐싱을 막아버리는 경우도 자주 보았다.</p>\n<p>하지만 서비스 워커는 이전 파일에서 변경점이 있는지 알아서 구분해주기 때문에 이런 귀찮은 작업을 할 필요가 없는것이다.</p>\n<h3>2. 업데이트할 서비스 워커파일에 에러가 나면 업데이트 하지 않는다</h3>\n<ul>\n<li>에러가 났다면 chrome 개발자 도구 기준으로 Application-Service Workers에서 확인 가능하다.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/my-blog/static/d0c60fb59bd09d1527a9779a6b3499d5/d0cc0/sw.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC30lEQVR42m1U7ZLaOBD0S9ymNiz425YlS7LkD/DCsrBwJLeXZJNU3v9VOjUD5tjU/ega12hozUy3CPp+hca1qHUDpQyM9cgLASEq5EUJ3w7QuoEx7nxuHLRpUGvLtXSmjUNdWzjXIdhud3h9/YKm8cjzEnlecGxcB9/2cL5HUVbIsuJyfkaS5AjD+IooSjgG6/UGX7+94fTpM5bLEW3XQ0oFVRvuwloPYxqUQkIIxV1KpfmSOE6RJNk7BObSLrEvFhEn4ySDEBJSatjGo1IWeZIjChOuWSxCrifCPxFsNlvsdi/Yvxx5N1RIpNMY9K10i8EvUVU1yrLi7vOsQBRNpMl/hM61+Pb2A5//+Ze7mkimcdK0QG0MumHkfZIQtFtlWsRxxvW3YMLD8QRrHWaz+ZWMDimWpYTShtdSVYovpVhJiywrkaZ0aX5F4JzHfn/A4fA3F08jT6qRokRGYpzJarZVkqTIspzVv0WgtcXj+gnPz3tWdCKk7opCsLq0M3exEflSKc01f5Ix4Tiu4Xx3tsaNFShSV5WsuSu2UW1YOFEpFEIizQse+Z3KZOiXlyOOx08Yxw3fMh3SNxmYRiUxjHUQhUAkKsxOB9w/jiwMqRxd9h70/RJdN/A4rPKlw0k18h2J0PUrHpe6o1w4j5DHMfI0RRjeqEzFh8OJO6SXQkmyyuR86jTPBRPR+GT2LC+RUa4sGVR/3aG1Dd6+/8SPn7/Qtv11VHrwtmkZ9JoI8ipGyTXpBe9EoTF92+Hp6Rm73QHDMLI4fthifH7FsD5B1Q2krPkt33ru/xAoLqz4B6vVGqtxc/6L0g2876/PjcA+FOpsbIJQEKVk89NldB7UjUc7PML3K5imhe+XcN2AxneorYPUFrK2EEqjJAvVhiOB8ta1aPsllLaojUOwjmLsRYVtKbBahFjOFxijGMMixDBfoH+Yo5s9oJ09wN1/5O/hJqfuPkDff4T86w7y7gN+AyrLGWJhe9jxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"개발자 도구에서의 Service Worker확인\"\n        title=\"\"\n        src=\"/my-blog/static/d0c60fb59bd09d1527a9779a6b3499d5/fcda8/sw.png\"\n        srcset=\"/my-blog/static/d0c60fb59bd09d1527a9779a6b3499d5/12f09/sw.png 148w,\n/my-blog/static/d0c60fb59bd09d1527a9779a6b3499d5/e4a3f/sw.png 295w,\n/my-blog/static/d0c60fb59bd09d1527a9779a6b3499d5/fcda8/sw.png 590w,\n/my-blog/static/d0c60fb59bd09d1527a9779a6b3499d5/d0cc0/sw.png 732w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>3. 설치된 새 서비스 워커의 활성화 조건</h3>\n<ol>\n<li>이전 서비스 워커가 제어하는 클라이언트(탭)이 없을 때 활성화 된다. 즉 모든 탭을 닫고 다시 들어가야 한다.</li>\n<li>탭이 하나만 있고, 해당 페이지를 새로고침한다고 활성화 되지 않는다.\n<ul>\n<li>self.skipWating을 통해 활성화를 빠르게 할 수 있지만 좋은 생각은 아니다. 아직 이전 서비스 워커가 작업중인 무언가가 있는데 강제로 활성화 한다면? 굉장히 찾기 힘든 버그를 유발할 수도 있다.</li>\n<li>물론 개발자가 동작을 확인 할 때는 이런 부분이 오히려 불편한 부분이기 때문에 그럴 땐 개발자 도구에서 skipWating을 클릭하여 강제로 활성화 해주면 된다.</li>\n</ul>\n</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/my-blog/static/06fa9fcbe6b0222d164c57870170d55b/914ae/sw2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVR42nVT7W7bMAz0awwDYsvWh/VhW7LiOlvcZUG7rmiWZdj7v8sNZBsvHbAfBCWaPh7JU+F9j65PCCHChx5KaShtENOW4/0wInSR7+SHYeRY10f2MWaOkSes4vn5Bd53aFsLpQwnTXefsJ1mWBdgjGVvbYBpHcpSoKrq1fheijVenM8X7PcLUhoRAgE7OBcQwsBgTaO4UCM1n+ta/teEkCgIQIgGm81rBSk1tLHouggbRk6iOOUIUUO8nSuy6/mGcXE6nfH4+J2rX38mo4p9ysjbGS706GNm1ptSYPNvyytwg+LldObW6MMr7YZNKoM0JuTdHsdpwq9xwNO84Og7zLJGrVpIHke7siRfnH78xHS3ewdIlZihDzC+x2fb4qlVmLuEe+fx1UhI46CV4UVZ6zmfW16WA5bly9rytZrWLcugtR6udZhbg1xXyI2ApuU0ihnSf8OQ2BOpgi4h9OuWCFBryzKhmaW0RcoT/JAhGo2q0bxx+WYEFOOIlDLfi8PhCGJJWrzOj3XnArOjdqggScm4AGnsu1nzvKVmuRH4Ckgt3iYRfXo522nHYifxftzN+HC/R6U0RFmv0rnddnG5/MbDwzcG/Ks3ShTMcoiZnyDPmBZX1usCbglc7Q9zcGJVRxU6gAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"개발자 도구에서의 Service Worker확인2(skipWating)\"\n        title=\"\"\n        src=\"/my-blog/static/06fa9fcbe6b0222d164c57870170d55b/fcda8/sw2.png\"\n        srcset=\"/my-blog/static/06fa9fcbe6b0222d164c57870170d55b/12f09/sw2.png 148w,\n/my-blog/static/06fa9fcbe6b0222d164c57870170d55b/e4a3f/sw2.png 295w,\n/my-blog/static/06fa9fcbe6b0222d164c57870170d55b/fcda8/sw2.png 590w,\n/my-blog/static/06fa9fcbe6b0222d164c57870170d55b/914ae/sw2.png 860w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>다음은 실제로 코드를 작성하여 짧게 사용해보려 한다 <a href=\"/my-blog/%EC%84%9C%EB%B9%84%EC%8A%A4%EC%9B%8C%EC%BB%A4-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\">서비스워커 사용해보기</a>.</p>","frontmatter":{"title":"서비스워커에 대하여","date":"March 11, 2023","description":"우선은 서비스워커에 대하여 얕게 알아보자"}},"previous":{"fields":{"slug":"/짧은-vitest-사용후기/"},"frontmatter":{"title":"짧은 vitest 사용후기"}},"next":{"fields":{"slug":"/서비스워커-사용해보기/"},"frontmatter":{"title":"서비스워커 사용해보기"}}},"pageContext":{"id":"015eae78-9005-5c56-8994-514cf77009a4","previousPostId":"491d416c-60ef-58ed-bbb1-4231fb042908","nextPostId":"99a260d6-9cfa-5f60-9b56-76a9dc8049da"}},"staticQueryHashes":["2630815655","2841359383"],"slicesMap":{}}