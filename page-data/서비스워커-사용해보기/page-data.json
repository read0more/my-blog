{"componentChunkName":"component---src-templates-blog-post-js","path":"/서비스워커-사용해보기/","result":{"data":{"site":{"siteMetadata":{"title":"read0more's blog"}},"markdownRemark":{"id":"df8ed517-8f22-5530-acc2-283d95e07975","excerpt":"서비스워커 등록 코드 및 동작 확인 위한 img태그 삽입 코드 서비스워커 코드 처음으로 서비스 워커가 있는 페이지에 들어와 설치 및 활성화 된 모습 dog 새로고침 하여 dog.svg에 대한 요청을 가로채 캐시에 있던 cat.svg를 받은 모습 cat fetch 프록시 확인 fetch","html":"<h2>서비스워커 등록 코드 및 동작 확인 위한 img태그 삽입 코드</h2>\n<pre><code class=\"language-js\">navigator.serviceWorker\n    .register(\"/sw.js\")\n    .then((reg) => console.log(\"서비스워커 등록됨\", reg))\n    .catch((err) => console.log(\"서비스워커 등록실패\", err));\n\n  // 이미지 캐싱 확인을 위한 코드\n  setTimeout(() => {\n    const img = new Image();\n    img.src = \"/dog.svg\";\n    img.style=\"width: 100px; height: 100px;\";\n    document.body.appendChild(img);\n  }, 1000);\n\n  // 요청을 가로채고 응답하는 것을 보기 위한 fetch\n  fetch(\"http://localhost:3000/api\")\n    .then((res) => res.json())\n    .then((data) => console.log(data));\n</code></pre>\n<h2>서비스워커 코드</h2>\n<pre><code class=\"language-js\">const image = \"/cat.svg\";\n\nself.addEventListener(\"install\", (event) => {\n  console.log(\"V1 installing…\");\n\n  // cat.svg를 캐싱\n  event.waitUntil(\n    caches.open(\"static-v1\").then((cache) => cache.add(image))\n  );\n});\n\nself.addEventListener(\"activate\", (event) => {\n  console.log(\"V1 now ready to handle fetches!\");\n});\n\nself.addEventListener(\"fetch\", (event) => {\n  const url = new URL(event.request.url);\n\n  // 같은 origin이고 dog.svg를 요청했다면 캐시에 있는 이미지(cat.svg)를 넘겨준다\n  if (url.origin == location.origin &#x26;&#x26; url.pathname == \"/dog.svg\") {\n    event.respondWith(caches.match(image));\n  }\n\n  // 현재 서버에 저런 경로가 없던간에 CORS문제가 있는 경로던 간에 서비스워커가 가로채면 상관없다\n  if (url.pathname === '/api') {\n    event.respondWith(new Response(JSON.stringify({ data: 'CORS가 났더라도 가로채기 때문에 상관없음' })));\n  }\n});\n</code></pre>\n<h2>처음으로 서비스 워커가 있는 페이지에 들어와 설치 및 활성화 된 모습</h2>\n<p><img src=\"./dog.png\" alt=\"dog\"></p>\n<h2>새로고침 하여 dog.svg에 대한 요청을 가로채 캐시에 있던 cat.svg를 받은 모습</h2>\n<p><img src=\"./cat.png\" alt=\"cat\"></p>\n<h2>fetch 프록시 확인</h2>\n<p><img src=\"./fetch.png\" alt=\"fetch\"></p>","frontmatter":{"title":"서비스워커 사용해보기","date":"March 11, 2023","description":"실제로 코드를 작성하여 확인해보자"}},"previous":{"fields":{"slug":"/서비스워커에-대하여/"},"frontmatter":{"title":"서비스워커에 대하여"}},"next":{"fields":{"slug":"/요소의-swap/"},"frontmatter":{"title":"DOM 요소의 swap"}}},"pageContext":{"id":"df8ed517-8f22-5530-acc2-283d95e07975","previousPostId":"bfd2cb06-0c85-5b9e-a278-e9a2e1f94a60","nextPostId":"57af6977-7746-5167-bf3c-fb28d619e67d"}},"staticQueryHashes":["2630815655","2841359383"],"slicesMap":{}}