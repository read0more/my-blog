{"componentChunkName":"component---src-templates-blog-post-js","path":"/서비스워커-사용해보기/","result":{"data":{"site":{"siteMetadata":{"title":"read0more's blog"}},"markdownRemark":{"id":"df8ed517-8f22-5530-acc2-283d95e07975","excerpt":"서비스워커 등록 코드 및 동작 확인 위한 img태그 삽입 코드 서비스워커 코드 처음으로 서비스 워커가 있는 페이지에 들어와 설치 및 활성화 된 모습  새로고침 하여 dog.svg에 대한 요청을 가로채 캐시에 있던 cat.svg를 받은 모습  fetch 프록시 확인","html":"<h2>서비스워커 등록 코드 및 동작 확인 위한 img태그 삽입 코드</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">navigator<span class=\"token punctuation\">.</span>serviceWorker\n    <span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/sw.js\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reg</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서비스워커 등록됨\"</span><span class=\"token punctuation\">,</span> reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"서비스워커 등록실패\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 이미지 캐싱 확인을 위한 코드</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> img <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    img<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"/dog.svg\"</span><span class=\"token punctuation\">;</span>\n    img<span class=\"token punctuation\">.</span>style<span class=\"token operator\">=</span><span class=\"token string\">\"width: 100px; height: 100px;\"</span><span class=\"token punctuation\">;</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 요청을 가로채고 응답하는 것을 보기 위한 fetch</span>\n  <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:3000/api\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>서비스워커 코드</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> <span class=\"token string\">\"/cat.svg\"</span><span class=\"token punctuation\">;</span>\n\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"install\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"V1 installing…\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// cat.svg를 캐싱</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span>\n    caches<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"static-v1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cache</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"activate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"V1 now ready to handle fetches!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fetch\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 같은 origin이고 dog.svg를 요청했다면 캐시에 있는 이미지(cat.svg)를 넘겨준다</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">==</span> location<span class=\"token punctuation\">.</span>origin <span class=\"token operator\">&amp;&amp;</span> url<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">==</span> <span class=\"token string\">\"/dog.svg\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span>caches<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 현재 서버에 저런 경로가 없던간에 CORS문제가 있는 경로던 간에 서비스워커가 가로채면 상관없다</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">===</span> <span class=\"token string\">'/api'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token string\">'CORS가 났더라도 가로채기 때문에 상관없음'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>처음으로 서비스 워커가 있는 페이지에 들어와 설치 및 활성화 된 모습</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d22013767114e4fde593d39dccbc58d2/3fe45/dog.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACG0lEQVR42qVR7W4SQRTdF2mB/f6c3Znd5cNiAWuJJg0aE620tbGwFqVNaqpC4lP4APyqvAoPwB8egacAjrlDaYq/TNzk5N659+yZc+cq8/kc0+kUo9EI9K1Wq/+C0mq1wDnHeDyWgovF4r4JrPBvwGPBu7vfmEwmmM1mUnC5XK6JRFguAMJqSY11fIz72pbDXz8H+Db4iG7nAtmHc2Tna3y66CLLviDLPqPT7aHb7a1j53LrnHUvcXt9jZt+H1+vrqBUay/BeQweCSRximJagmAh7NIBvLe3cN/cIGoPEBx/R/FsCP91H/xkiOj9D4TtIbxWD67HEPgMvs+g1BvPIeIiwihex1Ag4gl0w4TleNAMGyKtwGcCIqHI5ZnxFKEogsclcJ7Kf1goSPAZGo0DhCGHqurQNANqQZPC1ad17FVrSNIyTNOGZTmwbVdGhy7TdORyBeTz6gOUw8MmTk/P0G6foF5voFQqQ4gEhmHBcXxYtgvH9WE7HmzbkzXKqaYbFgqqLo1soFQqewiCEIWChp2dnCRQTo5ohIBF4CKFqhqyv7ubl6Cc3BF3y+H+fh0pLUIkYCySJLqJmpTrugnHDRAlVRkN04ZpOtIhjUw8Et1AKZef4OjoFd4dt1Gt1h4ENwTKaUERjxEnZfm2AS0mTmG7DPm/HdKbNZsvUKs15BhU3AhSLh16Phzfl0Is5PCDUMJjKTTdkkvcvOEfG+kHgmP3NRoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dog\"\n        title=\"\"\n        src=\"/static/d22013767114e4fde593d39dccbc58d2/f058b/dog.png\"\n        srcset=\"/static/d22013767114e4fde593d39dccbc58d2/c26ae/dog.png 158w,\n/static/d22013767114e4fde593d39dccbc58d2/6bdcf/dog.png 315w,\n/static/d22013767114e4fde593d39dccbc58d2/f058b/dog.png 630w,\n/static/d22013767114e4fde593d39dccbc58d2/3fe45/dog.png 699w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>새로고침 하여 dog.svg에 대한 요청을 가로채 캐시에 있던 cat.svg를 받은 모습</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2cee9d911c1a3ae10e1d7d0ba6e4030/416ee/cat.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.0506329113924%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACtElEQVR42q2S2U4aYRTHR30Fo2iHWdiGTRaZEXBANqPSNDZVMYClxjsfoW1SvWtasaAUC+2VkbfwFWriA3jjXtQYNZoYA8m/mWPlpjXxopP8cr7zn7PNd4bZ2vqJnZ0d3N3dodlsotFooKHZR2j+i0ajBfP23XssfFjA/3qY2o9VLBc/Y/njJxTzSyjk81gulPCl+JUorJRRoHOJ9JWVEqrlMiqlEr6vreHb6ioKS0so5vNkGVkOwOFwwO3ywOXsg6OvH/bkLGxjs5BGchDCEzDHpuF8Pgdrcg4W9QVskg1WyQ6RF6FnOXB6HmwvC54TwMTDUcj+EJSBIAbVCKLROEYTEcQTowgPxRAMqggEVURjwwiFIggEQ/AHVCI4OHTv+1XIyn0+43Z7YTCaIUk2mEwSPB4fvF4ZLpcXPt8AZNkPr9f3x8qELA/A4+mHogRIdzpdZLVcxmyWwHECDAYTBMEAvZ5Ht64XLKsnTafrRVeXDj09z8hqPGjd3T3Eg6admaAaoQ52uxNWq4O6ZmdykGUFPC9gYjKF6ekMUqk0JidTGB9/hZcvH2MCTDQWwaAaht1uB8dxSKczuLm5wcbGBhiGQa1Ww+XlJXZ3d3F0dITDw0Pi4OAA+/v72Nvbo3ea1XxmbGwY8eERKIoCSZKQy73B2dkZJbEsS3/A+fk5aVqR4+Nj1Ot18i8uLqj57e0trq+vKY5xub20EJvNAUEQkc2+piRtqvX1dZoykUggFotBFEX6ElmWSZuamsL8/DwWFxdRqVSwubkJxmSy0FJE0UiXmslkcXp6SuNfXV0hmUxS0afQ0dEBxmKx0naNRjNtKpOZwcnJCbG9vY3Ozs5WcFtbG9He3k5o2gOaToW1gjwvtgqm01nU679oumq1SkFa8lOn/KugNqFWULvDcrlMQa3uT+A3FemK8ChVDiwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cat\"\n        title=\"\"\n        src=\"/static/d2cee9d911c1a3ae10e1d7d0ba6e4030/f058b/cat.png\"\n        srcset=\"/static/d2cee9d911c1a3ae10e1d7d0ba6e4030/c26ae/cat.png 158w,\n/static/d2cee9d911c1a3ae10e1d7d0ba6e4030/6bdcf/cat.png 315w,\n/static/d2cee9d911c1a3ae10e1d7d0ba6e4030/f058b/cat.png 630w,\n/static/d2cee9d911c1a3ae10e1d7d0ba6e4030/416ee/cat.png 930w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>fetch 프록시 확인</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9f00e3e9d757efec9ff1666d8343d0e/07484/fetch.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVR42o2OzU7CQBRGeQlNTKSd6XQ6pC1YaJkCBfkrFRMFEhf+rJWVPgBPfwxFVibGxcl3b/Ldk9uYlg+kWU7U7hLFCfEx2wntTo+bJMXaIZPJHKMNgdYoqShGt0zGM2yWM5suyXq2diRJSiPrdZkXOUXWJdaC0HMIlUPku0RhhC1mJHZAXlVkszn9xZJ8WWKrisH6nulmiy1XOE0XKRWN7O2L+PWAeTnQfPzkYvXOZbXnar1HmA7S00jf4OoAoY9pcP2g3uvZtBBBCyk8xFGYb57p7j4Q0yea4x3NYsv1aIsz3uGZGOEIhPDqg1+4R+QJqU4fLoYRd2XJYjKisCmhL2riwMNX/kn2U/6Lc6/RSy39fEQYtZGeQvkaT2l0YFBK/1t4/vAbb023NVVMeRIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fetch\"\n        title=\"\"\n        src=\"/static/b9f00e3e9d757efec9ff1666d8343d0e/07484/fetch.png\"\n        srcset=\"/static/b9f00e3e9d757efec9ff1666d8343d0e/c26ae/fetch.png 158w,\n/static/b9f00e3e9d757efec9ff1666d8343d0e/6bdcf/fetch.png 315w,\n/static/b9f00e3e9d757efec9ff1666d8343d0e/07484/fetch.png 540w\"\n        sizes=\"(max-width: 540px) 100vw, 540px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"서비스워커 사용해보기","date":"March 11, 2023","description":"실제로 코드를 작성하여 확인해보자"}},"previous":{"fields":{"slug":"/서비스워커에-대하여/"},"frontmatter":{"title":"서비스워커에 대하여"}},"next":null},"pageContext":{"id":"df8ed517-8f22-5530-acc2-283d95e07975","previousPostId":"bfd2cb06-0c85-5b9e-a278-e9a2e1f94a60","nextPostId":null}},"staticQueryHashes":["2630815655","2841359383"],"slicesMap":{}}